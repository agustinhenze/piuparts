#!/bin/sh
set -e

. @sharedir@/piuparts/lib/read_config.sh

get_config_value SECTIONS global sections
get_config_value HTDOCS global output-directory


mkdir -p ${HTDOCS}/for-manpages.d.o

for SECTION in $SECTIONS ; do
	test -d $HTDOCS/$SECTION || continue
	get_config_value FLAGS $SECTION piuparts-flags ""
	if echo "$FLAGS" | grep -q scripts-log-alternatives ; then
		mkdir -p $(dirname ${HTDOCS}/for-manpages.d.o/${SECTION})
		@libdir@/piuparts/debiman-piuparts-distill \
			-logs_dir=${HTDOCS}/${SECTION} \
			-output=${HTDOCS}/for-manpages.d.o/${SECTION}.json.gz
	fi
done
